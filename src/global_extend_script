// å›½å†…DNSæœåŠ¡å™¨
const domesticNameservers = [
  "https://223.5.5.5/dns-query", // é˜¿é‡ŒDoH
  "https://doh.pub/dns-query" // è…¾è®¯DoHï¼Œå› è…¾è®¯äº‘å³å°†å…³é—­å…è´¹ç‰ˆIPè®¿é—®ï¼Œæ•…ç”¨åŸŸå
];
// å›½å¤–DNSæœåŠ¡å™¨
const foreignNameservers = [
  "https://cloudflare-dns.com/dns-query", // CloudflareDNS
  "https://77.88.8.8/dns-query", //YandexDNS
  "https://8.8.4.4/dns-query#ecs=1.1.1.1/24&ecs-override=true", // GoogleDNS
  "https://208.67.222.222/dns-query#ecs=1.1.1.1/24&ecs-override=true", // OpenDNS
  "https://9.9.9.9/dns-query", //Quad9DNS
];
// DNSé…ç½®
const dnsConfig = {
  "enable": true,
  "listen": "0.0.0.0:1053",
  // "ipv6": true,
  "prefer-h3": false,
  "respect-rules": true,
  "use-system-hosts": false,
  "cache-algorithm": "arc",
  "enhanced-mode": "fake-ip",
  "fake-ip-range": "198.18.0.1/16",
  "fake-ip-filter": [
    // æœ¬åœ°ä¸»æœº/è®¾å¤‡
    "+.lan",
    "+.local",
    // // Windowsç½‘ç»œå‡ºç°å°åœ°çƒå›¾æ ‡
    "+.msftconnecttest.com",
    "+.msftncsi.com",
    // QQå¿«é€Ÿç™»å½•æ£€æµ‹å¤±è´¥
    "localhost.ptlogin2.qq.com",
    "localhost.sec.qq.com",
    // å¾®ä¿¡å¿«é€Ÿç™»å½•æ£€æµ‹å¤±è´¥
    "localhost.work.weixin.qq.com"
  ],
  "default-nameserver": ["223.5.5.5","1.2.4.8"],
  "nameserver": [...foreignNameservers],
  "proxy-server-nameserver":[...domesticNameservers],
  "direct-nameserver":[...domesticNameservers],
  "direct-nameserver-follow-policy":false,
  "nameserver-policy": {
    "geosite:cn": domesticNameservers
  }
};
// è§„åˆ™é›†é€šç”¨é…ç½®
const ruleProviderCommon = {
  "type": "http",
  "format": "yaml",
  "interval": 86400
};
// è§„åˆ™é›†é…ç½®
const ruleProviders = {
  "reject": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt",
    "path": "./ruleset/loyalsoldier/reject.yaml"
  },
  "icloud": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt",
    "path": "./ruleset/loyalsoldier/icloud.yaml"
  },
  "apple": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt",
    "path": "./ruleset/loyalsoldier/apple.yaml"
  },
  "google": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt",
    "path": "./ruleset/loyalsoldier/google.yaml"
  },
  "proxy": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt",
    "path": "./ruleset/loyalsoldier/proxy.yaml"
  },
  "direct": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt",
    "path": "./ruleset/loyalsoldier/direct.yaml"
  },
  "private": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt",
    "path": "./ruleset/loyalsoldier/private.yaml"
  },
  "gfw": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt",
    "path": "./ruleset/loyalsoldier/gfw.yaml"
  },
  "tld-not-cn": {
    ...ruleProviderCommon,
    "behavior": "domain",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt",
    "path": "./ruleset/loyalsoldier/tld-not-cn.yaml"
  },
  "telegramcidr": {
    ...ruleProviderCommon,
    "behavior": "ipcidr",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt",
    "path": "./ruleset/loyalsoldier/telegramcidr.yaml"
  },
  "cncidr": {
    ...ruleProviderCommon,
    "behavior": "ipcidr",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt",
    "path": "./ruleset/loyalsoldier/cncidr.yaml"
  },
  "lancidr": {
    ...ruleProviderCommon,
    "behavior": "ipcidr",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt",
    "path": "./ruleset/loyalsoldier/lancidr.yaml"
  },
  "applications": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt",
    "path": "./ruleset/loyalsoldier/applications.yaml"
  },
  "openai": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/openai.yaml",
    "path": "./ruleset/MetaCubeX/openai.yaml"
  },
  "bybit": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/bybit.yaml",
    "path": "./ruleset/MetaCubeX/bybit.yaml"
  },
  "pikpak": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/pikpak.yaml",
    "path": "./ruleset/MetaCubeX/pikpak.yaml"
  },
  "anthropic": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/anthropic.yaml",
    "path": "./ruleset/MetaCubeX/anthropic.yaml"
  },
  "google-gemini": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/google-gemini.yaml",
    "path": "./ruleset/MetaCubeX/google-gemini.yaml"
  },
  "xai": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/xai.yaml",
    "path": "./ruleset/MetaCubeX/xai.yaml"
  },
  "perplexity": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/perplexity.yaml",
    "path": "./ruleset/MetaCubeX/perplexity.yaml"
  },
  "microsoft": {
    ...ruleProviderCommon,
    "behavior": "classical",
    "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/microsoft.yaml",
    "path": "./ruleset/MetaCubeX/microsoft.yaml"
  },
};
// è§„åˆ™
const rules = [
  // é¢å¤–è‡ªå®šä¹‰è§„åˆ™       //åœ¨æ­¤æ·»åŠ ä½ æƒ³è¦çš„è§„åˆ™
  "PROCESS-NAME,steam.exe,ğŸ¬ è‡ªå®šä¹‰ç›´è¿",
  "DOMAIN-SUFFIX,immersivetranslate.com,ğŸ³ è‡ªå®šä¹‰ä»£ç†",
  // "DOMAIN-SUFFIX,bing.com,ğŸ³ è‡ªå®šä¹‰ä»£ç†",
  // è‡ªå®šä¹‰è§„åˆ™
  "DOMAIN-SUFFIX,googleapis.cn,ğŸ”° æ¨¡å¼é€‰æ‹©", // GoogleæœåŠ¡
  "DOMAIN-SUFFIX,gstatic.com,ğŸ”° æ¨¡å¼é€‰æ‹©", // Googleé™æ€èµ„æº
  "DOMAIN-SUFFIX,xn--ngstr-lra8j.com,ğŸ”° æ¨¡å¼é€‰æ‹©", // Google Playä¸‹è½½æœåŠ¡
  "DOMAIN-SUFFIX,github.io,ğŸ”° æ¨¡å¼é€‰æ‹©", // Github Pages
  "DOMAIN,v2rayse.com,ğŸ”° æ¨¡å¼é€‰æ‹©", // V2rayseèŠ‚ç‚¹å·¥å…·
  // blackmatrix7 è§„åˆ™é›†

  // MetaCubeX è§„åˆ™é›†
  "RULE-SET,openai,ğŸ’¸ ChatGPT-Gemini-XAI-Perplexity",
  "RULE-SET,pikpak,ğŸ…¿ï¸ PikPak",
  "RULE-SET,bybit,ğŸª™ Bybit",
  "RULE-SET,anthropic,ğŸ’µ Claude",
  "RULE-SET,google-gemini,ğŸ’¸ ChatGPT-Gemini-XAI-Perplexity",
  "RULE-SET,xai,ğŸ’¸ ChatGPT-Gemini-XAI-Perplexity",
  "RULE-SET,perplexity,ğŸ’¸ ChatGPT-Gemini-XAI-Perplexity",
  // Loyalsoldier è§„åˆ™é›†
  "RULE-SET,applications,ğŸ”— å…¨å±€ç›´è¿",
  "RULE-SET,private,ğŸ”— å…¨å±€ç›´è¿",
  "RULE-SET,reject,ğŸ¥° å¹¿å‘Šè¿‡æ»¤",
  "RULE-SET,microsoft,â“‚ï¸ å¾®è½¯æœåŠ¡",
  "RULE-SET,icloud,ğŸ è‹¹æœæœåŠ¡",
  "RULE-SET,apple,ğŸ è‹¹æœæœåŠ¡",
  "RULE-SET,google,ğŸ“¢ è°·æ­ŒæœåŠ¡",
  "RULE-SET,proxy,ğŸ”° æ¨¡å¼é€‰æ‹©",
  "RULE-SET,gfw,ğŸ”° æ¨¡å¼é€‰æ‹©",
  "RULE-SET,tld-not-cn,ğŸ”° æ¨¡å¼é€‰æ‹©",
  "RULE-SET,direct,ğŸ”— å…¨å±€ç›´è¿",
  "RULE-SET,lancidr,ğŸ”— å…¨å±€ç›´è¿,no-resolve",
  "RULE-SET,cncidr,ğŸ”— å…¨å±€ç›´è¿,no-resolve",
  "RULE-SET,telegramcidr,ğŸ“² ç”µæŠ¥æ¶ˆæ¯,no-resolve",
  // å…¶ä»–è§„åˆ™
  "GEOIP,LAN,ğŸ”— å…¨å±€ç›´è¿,no-resolve",
  "GEOIP,CN,ğŸ”— å…¨å±€ç›´è¿,no-resolve",
  "MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼"
];
// ä»£ç†ç»„é€šç”¨é…ç½®
const groupBaseOption = {
  "interval": 0,
  "timeout": 3000,
  "url": "https://www.google.com/generate_204",
  "lazy": true,
  "max-failed-times": 3,
  "hidden": false
};

const landingNodeProxies = [
    {
      "name": "webshare", // ç»™ä½ çš„è½åœ°èŠ‚ç‚¹èµ·ä¸ªåå­—
      "server": "", // æ›¿æ¢æˆä½ çš„è½åœ°èŠ‚ç‚¹ IP æˆ–åŸŸå
      "port": 12345, // æ›¿æ¢æˆä½ çš„è½åœ°èŠ‚ç‚¹ç«¯å£
      "type": "socks5",
      "username": "", // æ›¿æ¢æˆä½ çš„ç”¨æˆ·å
      "password": "", // æ›¿æ¢æˆä½ çš„å¯†ç 
      "tls": false,
      "skip-cert-verify": true,
      "udp": true,
      "dialer-proxy": "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©"
    },
    // å¦‚æœæœ‰æ›´å¤šè½åœ°èŠ‚ç‚¹ï¼Œåœ¨è¿™é‡Œç»§ç»­æ·»åŠ 
    // {
    //   "name": "landing-node-2",
    //   ...
    //   "dialer-proxy": "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©"
    // }
];

const landingNodeNames = landingNodeProxies.map(p => p.name);

const proxyGroupsConfig = [
    {
        ...groupBaseOption,
        "name": "ğŸ”° æ¨¡å¼é€‰æ‹©",
        "type": "select",
        "proxies": [
            "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©",
            "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹",
            "ğŸ”— å…¨å±€ç›´è¿"
        ]
    },
    {
      ...groupBaseOption,
      "name": "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©",
      "type": "select",
      "proxies": ["â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/adjust.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹",
      "type": "select",
      "proxies": [...landingNodeNames],
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/openwrt.svg"
    },
    {
      ...groupBaseOption,
      "name": "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜",
      "type": "url-test",
      "tolerance": 50,
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/speed.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸš‘ æ•…éšœè½¬ç§»",
      "type": "fallback",
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/ambulance.svg"
    },
    {
      ...groupBaseOption,
      "name": "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)",
      "type": "load-balance",
      "strategy": "consistent-hashing",
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/merry_go.svg"
    },
    {
      ...groupBaseOption,
      "name": "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)",
      "type": "load-balance",
      "strategy": "round-robin",
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/balance.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸŒ å›½å¤–åª’ä½“",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)", "ğŸ”— å…¨å±€ç›´è¿"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/youtube.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ’¸ ChatGPT-Gemini-XAI-Perplexity",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "ğŸ”— å…¨å±€ç›´è¿", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"],
      "include-all": true,
      "exclude-filter": "(?i)æ¸¯|hk|hongkong|hong kong|ä¿„|ru|russia|æ¾³|macao",
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/chatgpt.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ’µ Claude",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "ğŸ”— å…¨å±€ç›´è¿", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/claude.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸª™ Bybit",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "ğŸ”— å…¨å±€ç›´è¿", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/link.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ…¿ï¸ PikPak",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "ğŸ”— å…¨å±€ç›´è¿", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/link.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ“² ç”µæŠ¥æ¶ˆæ¯",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)", "ğŸ”— å…¨å±€ç›´è¿"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/telegram.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ“¢ è°·æ­ŒæœåŠ¡",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)", "ğŸ”— å…¨å±€ç›´è¿"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/google.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ è‹¹æœæœåŠ¡",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)", "ğŸ”— å…¨å±€ç›´è¿"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/apple.svg"
    },
    {
      ...groupBaseOption,
      "name": "â“‚ï¸ å¾®è½¯æœåŠ¡",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "ğŸ”— å…¨å±€ç›´è¿", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/microsoft.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ¥° å¹¿å‘Šè¿‡æ»¤",
      "type": "select",
      "proxies": ["REJECT", "DIRECT"],
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/bug.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ”— å…¨å±€ç›´è¿",
      "type": "select",
      "proxies": ["DIRECT", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/link.svg"
    },
    {
      ...groupBaseOption,
      "name": "âŒ å…¨å±€æ‹¦æˆª",
      "type": "select",
      "proxies": ["REJECT", "DIRECT"],
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/block.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ¬ è‡ªå®šä¹‰ç›´è¿",
      "type": "select",
      "include-all": true,
      "proxies": ["ğŸ”— å…¨å±€ç›´è¿", "ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"],
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/unknown.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸ³ è‡ªå®šä¹‰ä»£ç†",
      "type": "select",
      "include-all": true,
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)", "ğŸ”— å…¨å±€ç›´è¿"],
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/openwrt.svg"
    },
    {
      ...groupBaseOption,
      "name": "ğŸŸ æ¼ç½‘ä¹‹é±¼",
      "type": "select",
      "proxies": ["ğŸ”° æ¨¡å¼é€‰æ‹©", "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©", "ğŸ•Šï¸ è½åœ°èŠ‚ç‚¹", "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜", "ğŸš‘ æ•…éšœè½¬ç§»", "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)", "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)", "ğŸ”— å…¨å±€ç›´è¿"],
      "include-all": true,
      "icon": "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/fish.svg"
    }
  ];

// å¤šè®¢é˜…åˆå¹¶ï¼Œè¿™é‡Œæ·»åŠ é¢å¤–çš„åœ°å€
const proxyProviders = {
  "p1": {
    "type": "http",   // è®¢é˜…é“¾æ¥
    "url": "https://google.com",
    "interval": 86400,  // è‡ªåŠ¨æ›´æ–°æ—¶é—´ 86400 (ç§’) / 3600 = 24 å°æ—¶
    "proxy": "ğŸ”° æ¨¡å¼é€‰æ‹©",
    "override": {
      "additional-prefix": "p1 |"  // èŠ‚ç‚¹åç§°å‰ç¼€ p1ï¼Œç”¨äºåŒºåˆ«æœºåœºèŠ‚ç‚¹
    }
  },
  // å…¶ä»–è®¢é˜…åœ°å€
}

// ç¨‹åºå…¥å£
function main(config) {
  const originalProxies = config?.proxies ? [...config.proxies] : [];
  const proxyCount = originalProxies.length;
  const originalProviders = config?.["proxy-providers"] || {};
  const proxyProviderCount = originalProviders !== null && typeof originalProviders === 'object' ? Object.keys(originalProviders).length : 0;

  if (proxyCount === 0 && proxyProviderCount === 0) {
    throw new Error("é…ç½®æ–‡ä»¶ä¸­æœªæ‰¾åˆ°ä»»ä½•ä»£ç†");
  }

  config["dns"] = dnsConfig;
  config["rule-providers"] = ruleProviders;
  config["rules"] = rules; // Use the modified rules array defined above

  // Process original proxies (just ensure UDP)
  const processedProxies = originalProxies.map(proxy => {
      if (proxy && typeof proxy === 'object' && proxy.name) {
          proxy.udp = true;

          // èŠ‚ç‚¹ç»‘å®šçš„æ¥å£ï¼Œä»æ­¤æ¥å£å‘èµ·è¿æ¥ï¼Œé€‚ç”¨äºéƒ¨åˆ†vpnæƒ…å†µ
          // proxy["interface-name"] = "WLAN"
          // proxy["interface-name"] = "ä»¥å¤ªç½‘"
      } else {
          console.warn("è­¦å‘Šï¼šå‘ç°ä¸€ä¸ªæ— æ•ˆæˆ–ç¼ºå°‘åç§°çš„åŸå§‹ä»£ç†é…ç½®:", proxy);
          return null;
      }
      return proxy;
  }).filter(p => p !== null);

  // Combine proxies
  config["proxies"] = [...processedProxies, ...landingNodeProxies];
  config["proxy-providers"] = {
    ...originalProviders,
    ...proxyProviders
  };

  // è½¬ä¹‰æ­£åˆ™å…ƒå­—ç¬¦ï¼Œä¿è¯åå­—æŒ‰â€œå­—é¢é‡â€åŒ¹é…
  function escapeForRegExp(s) {
    return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  // å–å‡ºæ‰€æœ‰è½åœ°èŠ‚ç‚¹çš„åå­—ï¼Œå¹¶åšè½¬ä¹‰
  const landingNodeNames = landingNodeProxies.map(p => p.name);
  const escapedNames = landingNodeNames
    .map(escapeForRegExp)
    .join('|');

  // æ„é€ åªåŒ¹é…å®Œå…¨ç­‰äºè¿™äº›åå­—çš„æ­£åˆ™
  const excludeLandingFilter = escapedNames
    ? `^(?:${escapedNames})$`
    : null;

  // å®šä¹‰éœ€è¦æ’é™¤è½åœ°èŠ‚ç‚¹çš„ç»„å
  const groupsToExcludeLandingNodes = [
      "âš™ï¸ èŠ‚ç‚¹é€‰æ‹©",
      "â™»ï¸ å»¶è¿Ÿé€‰ä¼˜",
      "âš–ï¸ è´Ÿè½½å‡è¡¡(æ•£åˆ—)",
      "â˜ï¸ è´Ÿè½½å‡è¡¡(è½®è¯¢)"
  ];

  // éå†æ‰€æœ‰ä»£ç†ç»„é…ç½®ï¼Œä¸ºæŒ‡å®šçš„ç»„æ·»åŠ æ’é™¤è½åœ°èŠ‚ç‚¹çš„è¿‡æ»¤å™¨
  const finalProxyGroups = proxyGroupsConfig.map(group => {
      // æ£€æŸ¥å½“å‰ç»„åæ˜¯å¦åœ¨éœ€è¦æ’é™¤è½åœ°èŠ‚ç‚¹çš„åˆ—è¡¨ä¸­ï¼Œå¹¶ä¸”ç¡®å®æœ‰è½åœ°èŠ‚ç‚¹éœ€è¦æ’é™¤
      if (groupsToExcludeLandingNodes.includes(group.name) && excludeLandingFilter) {
          // åˆå¹¶å·²æœ‰çš„ exclude-filterï¼šåªè¦æ—§è§„åˆ™ æˆ– æ–°æ’é™¤è§„åˆ™ åŒ¹é…ï¼Œå°±æ’é™¤
          // å¦‚æœ group["exclude-filter"] å·²å­˜åœ¨ï¼Œåˆ™ç”¨ | è¿æ¥æ–°æ—§è§„åˆ™
          // å¦åˆ™ç›´æ¥ä½¿ç”¨æ–°çš„ excludeLandingFilter
          const existingFilter = group["exclude-filter"];
          group["exclude-filter"] = existingFilter
              ? `(${existingFilter})|(${excludeLandingFilter})`
              : excludeLandingFilter;

          console.log(
              `ä¿¡æ¯ï¼šä¸ºç»„ [${group.name}] æ·»åŠ æˆ–åˆå¹¶äº†è½åœ°èŠ‚ç‚¹æ’é™¤è¿‡æ»¤å™¨: ${group["exclude-filter"]}`
          );
      }
      return group; // è¿”å›ï¼ˆå¯èƒ½å·²ä¿®æ”¹çš„ï¼‰ç»„é…ç½®
  });

  config["proxy-groups"] = finalProxyGroups; // ä½¿ç”¨å¤„ç†è¿‡çš„ä»£ç†ç»„
  return config;
}